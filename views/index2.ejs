<%- include('partials/header'); %>

<head>
  <script src="/socket.io/socket.io.js"></script>
  <!-- Bootstrap core CSS -->
  <style media="screen">
    /* Chat containers */
    .chatcontainer {
      border: 2px solid #dedede;
      background-color: #f1f1f1;
      border-radius: 5px;
      padding: 2px;
      margin: 10px 5px;
    }

    /* Darker chat container */
    .darker {
      border-color: #ccc;
      background-color: #ddd;
    }

    /* Clear floats */
    .chatcontainer::after {
      content: "";
      clear: both;
      display: table;
    }

    /* Style images */
    .chatcontainer img {
      float: left;
      max-width: 60px;
      width: 100%;
      margin-right: 20px;
      border-radius: 50%;
    }

    /* Style the right image */
    .chatcontainer .right {
      float: right;
      margin-left: 20px;
      margin-right: 0;
    }

    /* Style time text */
    .time-right {
      float: right;
      color: #aaa;
    }

    /* Style time text */
    .time-left {
      float: left;
      color: #999;
    }
  </style>
</head>
<nav class="navbar navbar-inverse navbar-expand-lg bg-dark" role="navigation-demo">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-translate">
      <a class="navbar-brand" href="#0">Task Allocator</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="navbar-toggler-icon"></span>
        <span class="navbar-toggler-icon"></span>
        <span class="navbar-toggler-icon"></span>
      </button>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a href="/chat" class="nav-link">
            CHAT
          </a>
        </li>
        <li class="nav-item">
          <a href="#pablo" class="nav-link">
            UPLOAD
          </a>
        </li>
        <li class="nav-item">
          <a href="#pablo" class="btn btn-rose btn-raised btn-fab btn-round" data-toggle="dropdown">
            <i class="material-icons">email</i>
          </a>
        </li>
        <li class="dropdown nav-item">
          <a href="#pablo" class="profile-photo dropdown-toggle nav-link" data-toggle="dropdown">
            <div class="profile-photo-small">
              <img src="/assets/img/faces/avatar.jpg" alt="Circle Image" class="rounded-circle img-fluid">
            </div>
          </a>
          <div class="dropdown-menu dropdown-menu-right">
            <h6 class="dropdown-header">Dropdown header</h6>
            <a href="#pablo" class="dropdown-item">Me</a>
            <a href="#pablo" class="dropdown-item">Settings and other stuff</a>
            <a href="#pablo" class="dropdown-item">Sign out</a>
          </div>
        </li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-->
</nav>
<%-include('partials/sidebar')%>
<div class="container">

  <div class="card" style="width:100%;height: 500px;overflow: auto;">
    <div id="messages">

    </div>
  </div>

  <div class="jumbotron">
    <h1 class="display-4">Send Message</h1>
    <br>
    <!-- <input id = "name" class="form-control" placeholder="Name">
        <br> -->
    <textarea id="message" class="form-control" placeholder="Your Message Here"></textarea>
    <br>
    <button id="send" class="btn btn-success">Send</button>
  </div>
  <input type="text" id="userName" style="visibility:hidden" name="" value="<%= user.username %>">

</div>
<script>
  var socket = io();
  $(() => {
    $("#send").click(() => {
      sendMessage({
        name: $("#userName").val(),
        message: $("#message").val()
      });
    })

    getMessages()
  })

  socket.on('message', addMessages)

  function addMessages(message) {
    if ('<%=user.username%>' == `${message.name}`) {
      $("#messages").append(`<div class="chatcontainer darker">
        <h4>${message.name}</h4>
        <p>${message.message}</p>
        <span class="time-left">11:00</span>
      </div>`)

    } else {
      $("#messages").append(`<div class="chatcontainer">
        <h4 class="right">${message.name}</h4>
        <p>${message.message}</p>
        <span class="time-right">11:00</span>
      </div>`)
    } //nikali leje class='right' just for showing'

  }

  function getMessages() {
    $.get('http://localhost:3001/messages/<%= project %>', (data) => {
      data.forEach(addMessages);
    })
  }

  function sendMessage(message) {
    $.post('http://localhost:3001/messages/<%= project %>', message)
  }
</script>
</body>

</html>
<%-include("partials/footer")-%>
